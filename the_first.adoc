:backend: revealjs
:customcss: the_first.css
[.white.background]
= Квадратно-гнездовое мышление как образ жизни
Как маленькой команде успешно управлять немаленькой инфраструктурой.

[.white.background]
== Когда каждый может обидеть
image::images/david_&_goliaf.jpg[]

[.white.background]
== Что имеем на входе?
[%step]
* Облачный провайдер - DigitalOcean
* Terraform
** ~100 виртуальных машин
** ~20 dns-записей
* Ansible
** ~20 плейбуков с пачкой ролей

[.white.background]
== Что болит?
[%step]
* Нет быстрого способа переехать к другому провайдеру.
* Отвратительное масштабирование системы.
* Деплой тоже требует дебага.

[.white.background]
== Погнали по пунктам?
image::images/the_roof_is_on_fire.jpg[]

[.white.background]
=== !
Оставь меня, я задержу их.
----
resource "digitalocean_droplet" "pgdb-dev" {
    image = "31754481"
    name = "pgdb-dev.888toto.bet"
    region = "ams2"
    size = "s-2vcpu-2gb"
    private_networking = "true"
    resize_disk = "false"
    ssh_keys = ["${var.ssh_keys}"]
    user_data = "${file("minimal.conf")}"
}
----
[%step]
* Ах, если бы только ноды.

[.white.background]
=== !
Посыпьте их пеплом
----
variable "eps_names" { default = ["epsilon400.888toto.bet", 
                                  "epsilon401.888toto.bet", 
                                  "epsilon402.888toto.bet", 
                                  "epsilon403.888toto.bet", 
                                  "epsilon404.888toto.bet",
                                  "epsilon405.888toto.bet"] }
----
[%step]
* Когда в твою инфраструктуру попадает цикл.

[.white.background]
=== !
Когда каждый ansible-playbook - произведение искусства.
----
---
- name: configure backoffice server
... 10 more lines
  roles:
    - role: do_hostname
... 20 more lines
    - role: backoffice
  tasks:
... 50 more lines
    - name: Reload nginx
      service:
        name: nginx
        state: reloaded
----
[%step]
* Долго, дорого, будет цениться после смерти автора(нет).