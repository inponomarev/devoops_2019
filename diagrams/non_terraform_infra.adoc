:backend: revealjs
:revealjs_theme: white
:customcss: common.css
:revealjs_transition: none

=== !
["graphviz", "terraform_kubernetes", "svg"]
---------------------------------------------------------------------
digraph main {
  rankdir = LR;
  terraform  [shape=polygon,sides=6,peripheries=3,color=blueviolet,style=filled,label="Terraform"];
  cloud_provider -> k8s_cluster -> helm -> chart;
  terraform -> cloud_provider[label="infrastructure"];
  terraform -> k8s_cluster[label="secrets, tiller"];
  terraform -> helm[label="datasource"];
  terraform -> chart[label="values"];
}
---------------------------------------------------------------------

=== !
["graphviz", "terraform_kubernetes1", "svg"]
---------------------------------------------------------------------
digraph main {
  rankdir = LR;
  terraform  [shape=polygon,sides=6,peripheries=3,color=blueviolet,style=filled,label="Terraform"];
  cloud_provider -> k8s_cluster -> helm -> chart;
  terraform -> cloud_provider[label="infrastructure"];
  terraform -> k8s_cluster[label="secrets, tiller"];
  terraform -> helm[label="datasource"];
  terraform -> chart[label="values"];
  chart -> k8s_cluster[label="scaling, ingress"]
}
---------------------------------------------------------------------

=== !
----
odds-api:
  image:
    tag: 1.0.5
  nodeSelector:
    cloud.google.com/gke-nodepool: support-pool
  ingress:
    enabled: true
    annotations:
      kubernetes.io/ingress.class: nginx
    hosts:
      - host: odds-api.888totobet.com
        paths:
         - "/"
----

=== !
----
nginx-ingress:
  controller:
    nodeSelector:
      cloud.google.com/gke-nodepool: support-pool
    service:
      annotations: 
        external-dns.alpha.kubernetes.io/hostname: grafana.888totobet.com, odds-api.888totobet.com, kibana.888totobet.com
  default-backend:
    nodeSelector:
      cloud.google.com/gke-nodepool: support-pool
----

=== !
----
external-dns:
  provider: digitalocean
  digitalocean:
    apiToken: "very_secret_api_token"
  rbac:
    create: true
  sources:
    - service
  logLevel: info
  publishInternalServices: true
  registry: noop
----

=== Здесь должен быть код для cert-manager

=== Здесь должен быть код для cluster-autoscaler

=== !
["graphviz", "terraform_kubernetes2", "svg"]
---------------------------------------------------------------------
digraph main {
  rankdir = LR;
  terraform  [shape=polygon,sides=6,peripheries=3,color=blueviolet,style=filled,label="Terraform"];
  cloud_provider -> k8s_cluster -> helm -> chart;
  terraform -> cloud_provider[label="infrastructure"];
  terraform -> k8s_cluster[label="secrets, tiller"];
  terraform -> helm[label="datasource"];
  terraform -> chart[label="values"];
  chart -> k8s_cluster[label="scaling, ingress, dns"]
  k8s_cluster -> cloud_provider[label="infrastructure, dns, lb"]
}
---------------------------------------------------------------------

=== !
["graphviz", "terraform_kubernetes3", "svg"]
---------------------------------------------------------------------
digraph main {
  rankdir = LR;
  terraform  [shape=polygon,sides=6,peripheries=3,color=blueviolet,style=filled,label="Terraform"];
  cloud_provider -> k8s_cluster -> helm -> chart;
  terraform -> cloud_provider[label="infrastructure"];
  terraform -> k8s_cluster[label="secrets, tiller"];
  terraform -> helm[label="datasource"];
  terraform -> chart[label="values",color=red];
  chart -> k8s_cluster[label="scaling, ingress, dns"]
  k8s_cluster -> cloud_provider[label="infrastructure, dns, lb"]
}
---------------------------------------------------------------------

== Почему это удобно?
[%step]
* Всё находится в default values.yml в чарте.
* И инфраструктура тоже.
* И ничего из этого не попадает в tf файл.